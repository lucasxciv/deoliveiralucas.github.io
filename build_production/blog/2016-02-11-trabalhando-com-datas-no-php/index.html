<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Trabalhando com manipulação de datas no PHP">

        <meta property="og:title" content="Trabalhando com datas no PHP | @lucasxciv"/>
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://lucasxciv.dev/blog/2016-02-11-trabalhando-com-datas-no-php"/>
        <meta property="og:description" content="Trabalhando com manipulação de datas no PHP" />

        <title>Trabalhando com datas no PHP | @lucasxciv</title>

        <link rel="home" href="https://lucasxciv.dev">
        <link rel="icon" href="/assets/img/logo.jpeg">
        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="@lucasxciv Atom Feed">

                    <!-- Insert analytics code here -->
        
        <link rel="stylesheet" href="/assets/build/css/main.css?id=63adab265308ca0d59e018de30ed4785">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    </head>

    <body class="flex flex-col justify-between min-h-screen bg-base3 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-base2 py-4" role="banner">
            <div class="container flex items-center max-w-5xl mx-auto px-4 lg:px-8">
                <div id="vue-search" class="grid mx-auto text-center">
                    <div class="text-center items-center justify-center">
                        <img class="h-20 mx-auto shadow border-solid border-4 border-base3 rounded-full" src="/assets/img/logo.jpeg" alt="@lucasxciv logo" />
                    </div>
                    <div class="mt-2">
                        <h1 class="text-2xl text-base01 font-semibold my-0">Lucas de Oliveira</h1>
                        <h1 class="text-xs text-base01 font-semibold my-0">software developer</h1>
                    </div>

                    <nav class="hidden lg:flex items-center text-center text-sm mt-4">
    <a title="@lucasxciv Blog" href="/"
        class="mx-3 text-base01 hover:text-base1 ">
        Blog
    </a>

    <a title="@lucasxciv About" href="/about"
        class="mx-3 text-base01 hover:text-base1 ">
        About
    </a>

    <a title="@lucasxciv Contact"
       href="https://www.linkedin.com/in/lucasxciv"
       target="_blank"
       class="mx-3 text-base01 hover:text-base1">
        LinkedIn <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup>
    </a>

    <a title="@lucasxciv Contact"
       href="https://github.com/lucasxciv"
       target="_blank"
       class="mx-3 text-base01 hover:text-base1">
        GitHub <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup>
    </a>

    <a title="@lucasxciv Contact"
       href="https://x.com/lucasxciv"
       target="_blank"
       class="mx-3 text-base01 hover:text-base1">
        Twitter <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup>
    </a>

    <a title="@lucasxciv Contact"
       href="https://nostr.lucasxciv.dev"
       target="_blank"
       class="mx-3 text-base01 hover:text-base1">
        Nostr <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup>
    </a>

    <a title="@lucasxciv Contact"
       href="https://stackoverflow.com/users/7435669/lucasxciv"
       target="_blank"
       class="mx-3 text-base01 hover:text-base1">
        Stack Overflow <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup>
    </a>
</nav>

                    <button class="flex justify-center items-center bg-base3 shadow h-10 px-5 rounded-full lg:hidden focus:outline-none mt-4"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-base03 h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-base03 h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

                </div>
            </div>
        </header>

        <nav id="js-nav-menu" class="w-auto px-2 pt-6 pb-2 bg-base2 shadow hidden lg:hidden">
    <ul class="my-0">
        <li class="pl-4">
            <a
                title="@lucasxciv Blog"
                href="/"
                class="block mt-0 mb-4 text-sm text-base01 hover:text-base1 "
            >Blog</a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv About"
                href="/about"
                class="block mt-0 mb-4 text-sm text-base01 hover:text-base1 text-base01 hover:text-base1"
            >About</a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv Contact"
                href="https://www.linkedin.com/in/lucasxciv"
                target="_blank"
                class="block mt-0 mb-4 text-sm no-underline text-base01 hover:text-base1"
            >LinkedIn <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup></a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv Contact"
                href="https://github.com/lucasxciv"
                target="_blank"
                class="block mt-0 mb-4 text-sm no-underline text-base01 hover:text-base1"
            >GitHub <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup></a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv Contact"
                href="https://x.com/lucasxciv"
                target="_blank"
                class="block mt-0 mb-4 text-sm no-underline text-base01 hover:text-base1"
            >Twitter <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup></a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv Contact"
                href="https://nostr.lucasxciv.dev"
                target="_blank"
                class="block mt-0 mb-4 text-sm no-underline text-base01 hover:text-base1"
            >Nostr <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup></a>
        </li>
        <li class="pl-4">
            <a
                title="@lucasxciv Contact"
                href="https://stackoverflow.com/users/7435669/lucasxciv"
                target="_blank"
                class="block mt-0 mb-4 text-sm no-underline text-base01 hover:text-base1"
            >Stack Overflow <sup><i class="fa-solid fa-arrow-up-right-from-square opacity-50"></i></sup></a>
        </li>
    </ul>
</nav>

        <main role="main" class="flex-auto w-full container max-w-4xl mx-auto py-16 px-6">
                
    <h1 class="leading-none mb-2 text-base01">Trabalhando com datas no PHP</h1>

    <p class="text-base0 text-xl md:mt-0">de Oliveira, Lucas  •  February 11, 2016</p>

                        <a
                href="/blog/categories/php"
                title="View posts in php"
                class="inline-block bg-base2 hover:text-base1 leading-loose tracking-wide text-base01 uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >php</a>
                    <a
                href="/blog/categories/datetime"
                title="View posts in datetime"
                class="inline-block bg-base2 hover:text-base1 leading-loose tracking-wide text-base01 uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >datetime</a>
            
    <div class="border-b border-base2 mb-10 pb-4 text-base01" v-pre>
        <p>Com o PHP é possível trabalhar com datas de várias formas, podemos utilizar funções, como, <code>date()</code>, <code>time()</code>, <code>strtotime()</code>, <code>mktime()</code>, ou a classe <code>DateTime()</code> que também é muito poderosa e disponibiliza recursos que realmente facilitam muito a manipulação de datas. Além disso, existem várias bibliotecas desenvolvidas pela comunidade PHP que também podem nos ajudar muito quando precisamos manipular datas, porém não será utilizado nesse <em>post</em>, mas que poderá ser conteúdo para um próximo.</p>

<p>Nesse <em>post</em> vou mostrar algumas soluções comuns que podemos encontrar quando precisamos manipular datas.</p>

<h2>Definindo o <em>timezone</em></h2>

<p>Antes de começar a utilizar as funções ou classes do PHP para manipular as datas, é importante configurar o <em>timezone</em> do PHP, pois caso contrário, podemos ter problemas com datas ou horários incorretos, ou ainda ter uma mensagem de <code>E_WARNING</code> toda vez que for utilizar algum recurso do PHP para trabalhar as datas.
Podemos definir o <em>timezone</em> padrão do PHP alterando uma linha no arquivo <code>php.ini</code> de <code>;date.timezone =</code> para <code>date.timezone = America/Sao_Paulo</code> ou adicionando um comando <code>date_default_timezone_set('America/Sao_Paulo');</code> no início do <em>script</em>. Além disso, é possível configurar o PHP de acordo com o seu <em>timezone</em>, conforme mostra a <a href="http://php.net/manual/pt_BR/timezones.php">lista de <em>timezones</em> suportados</a> no site do PHP.</p>

<h2>Diferença de dias entre datas</h2>

<p>Vou mostrar algumas maneiras de encontrar a quantidade de dias entre datas.
A primeira é utilizando o <code>mktime()</code> para pegar o <em>timestamp</em> das datas de início e fim, logo após devemos subtrair a data de fim pela data de início, assim temos o resultado da diferença em <em>timestamp</em>, por último é preciso apenas converter esse resultado para dias.</p>

<pre><code class="language-php">&lt;?php

$dtInicio = '2015-12-01';
$dtFim = '2016-01-01';

$arrDtInicio = explode('-', $dtInicio);
$arrDtFim = explode('-', $dtFim);

$tsInicio = mktime(0, 0, 0, $arrDtInicio[1], $arrDtInicio[2], $arrDtInicio[0]);
$tsFim = mktime(0, 0, 0, $arrDtFim[1], $arrDtFim[2], $arrDtFim[0]);

$tsDiff = $tsFim -$tsInicio;

$quantidadeDias = $tsDiff /86400; // 86400 quantidade de segundos em um dia

echo $quantidadeDias; // 31
</code></pre>

<p>Outra maneira ainda mais simples é utilizando o <code>strtotime()</code>, pois caso a data já esteja no formato correto (<code>yyyy-mm-dd</code>) é necessário apenas passar a data para o <code>strtotime()</code>, pegar o <em>timestamp</em> e fazer o cálculo.</p>

<pre><code class="language-php">&lt;?php

$dtInicio = '2015-12-01';
$dtFim = '2016-01-01';

$tsDiff = strtotime($dtFim) -strtotime($dtInicio);

$quantidadeDias = $tsDiff /86400; // 86400 quantidade de segundos em um dia

echo $quantidadeDias; // 31
</code></pre>

<p>Também podemos utilizar a classe <code>DateTime()</code> que ainda tem uma <a href="http://php.net/manual/en/datetime.diff.php">forma mais simples de formatar a saída</a>.</p>

<pre><code class="language-php">&lt;?php

$dtInicio = '2015-12-01';
$dtFim = '2016-01-01';

$dateTime = new DateTime($dtInicio);
$dateDiff = $dateTime-&gt;diff(new DateTime($dtFim));
$quantidadeDias = $dateDiff-&gt;format('%a');

echo $quantidadeDias; // 31
</code></pre>

<h2>Quantidade de dias uteis</h2>

<p>Com o PHP é bem simples desenvolver uma função para contar a quantidade de dias uteis (seg. à sex.) utilizando o <code>strtotime()</code>. Para isso é preciso obter o <em>timestamp</em> das datas de início e fim, logo em seguida executar um <em>loop</em> que irá verificar se é dia útil ou não, caso seja, será acrescentado um ao contador. Além disso, deixei um parâmetro como opcional para que seja passado os feriados, caso seja necessário.</p>

<p>Executei dois exemplos, o primeiro passei por parâmetro somente o intervalo de datas que gostaria de saber a quantidade de dias uteis, já no segundo exemplo foi passado também um <code>array</code> com as datas referentes aos feriados.</p>

<pre><code class="language-php">&lt;?php

function getDiasUteis($dtInicio, $dtFim, $feriados = []) {
    $tsInicio = strtotime($dtInicio);
    $tsFim = strtotime($dtFim);

    $quantidadeDias = 0;
    while ($tsInicio &lt;= $tsFim) {
        // Verifica se o dia é igual a sábado ou domingo, caso seja continua o loop
        $diaIgualFinalSemana = (date('D', $tsInicio) === 'Sat' || date('D', $tsInicio) === 'Sun');
        // Verifica se é feriado, caso seja continua o loop
        $diaIgualFeriado = (count($feriados) &amp;&amp; in_array(date('Y-m-d', $tsInicio), $feriados));

        $tsInicio += 86400; // 86400 quantidade de segundos em um dia

        if ($diaIgualFinalSemana || $diaIgualFeriado) {
            continue;
        }

        $quantidadeDias++;
    }

    return $quantidadeDias;
}

echo getDiasUteis('2015-12-07', '2016-01-08'); // 25
echo PHP_EOL;

$feriados = [
    '2015-12-25',
    '2015-12-26',
    '2016-01-01'
];

echo getDiasUteis('2015-12-07', '2016-01-08', $feriados); // 23
</code></pre>

<p>Perceba que em nenhum dos exemplos anteriores me importei com a formatação da data, utilizei o formato que normalmente é utilizado pelo banco de dados por padrão, isso por que a seguir veremos algumas maneiras de formatar datas.</p>

<h2>Formatando datas</h2>

<p>É comum quando estamos desenvolvendo algum sistema e precisamos converter datas, por exemplo, do formato do banco de dados para o formato do Brasil, ou vice-versa. Para isso o PHP permite executar essa tarefa de diferentes maneiras, a seguir vou mostrar algumas formas de formatar utilizando funções de data e outras utilizando funções do PHP que não são especificamente para se trabalhar com datas, mas que também funciona :).</p>

<p>Utilizando a classe <code>DateTime()</code></p>

<pre><code class="language-php">&lt;?php

$data = '2016-01-01';
$dateTime = DateTime::createFromFormat('Y-m-d', $data);
$dataFormatada = $dateTime-&gt;format('d/m/Y');
echo $dataFormatada; // 01/01/2016

echo PHP_EOL;

$data = '01/01/2016';
$dateTime = DateTime::createFromFormat('d/m/Y', $data);
$dataFormatada = $dateTime-&gt;format('Y-m-d');
echo $dataFormatada; // 2016-01-01
</code></pre>

<p>Convertendo para o formato do Brasil com o <code>strtotime()</code></p>

<pre><code class="language-php">&lt;?php

$data = '2016-01-01';
$dataFormatada = strtotime('d/m/Y', strtotime($data));

echo $dataFormatada; // 01/01/2016
</code></pre>

<p>Outra forma bem simples é utilizando algumas funções de <code>array</code></p>

<pre><code class="language-php">&lt;?php

$data = '2016-01-01';
$dataFormatada = implode('/', array_reverse(explode('-', $data)));
echo $dataFormatada; // 01/01/2016

echo PHP_EOL;

$data = '01/01/2016';
$dataFormatada = implode('-', array_reverse(explode('/', $data)));
echo $dataFormatada; // 2016-01-01
</code></pre>

<h2>Traduzindo datas com <code>strftime()</code></h2>

<p>Podemos utilizar a função <code>strftime()</code> para exibir as datas em português, já que por padrão as funções retornam as descrições em inglês, para fazer isso precisamos primeiramente configurar o local com a função <code>setlocale()</code> e então utilizar a função <code>strftime()</code> passando o formato e o <em>timestamp</em> como parâmetros para formatar a data, lembrando que o <em>timezone</em> deve estar configurado também.</p>

<pre><code class="language-php">&lt;?php

$tsAtual = time(); // pega timestamp atual

setlocale(LC_ALL, 'pt_BR', 'pt_BR.utf-8', 'portuguese');
$dataTraduzida = strftime('%A, %d de %B de %Y', $tsAtual);

echo $dataTraduzida; // quinta-feira, 11 de fevereiro de 2016

echo PHP_EOL;

$dtInput = strtotime('2015-12-25'); // pega timestamp da data

setlocale(LC_ALL, 'pt_BR', 'pt_BR.utf-8', 'portuguese');
$dataTraduzida = strftime('%A, %d de %B de %Y', $dtInput);

echo $dataTraduzida; // sexta-feira, 25 de dezembro de 2015
</code></pre>

<h2>Utilizando mais <code>strtotime()</code> e <code>DateTime()</code></h2>

<p>A função <code>strtotime()</code> e a classe <code>DateTime()</code> realmente nos ajudam muito a trabalhar com datas, por isso vou mostrar mais algumas de suas funcionalidades, pois acho bem legal a forma que podemos interagir com essas duas ferramentas do PHP.</p>

<pre><code class="language-php">&lt;?php

echo date("d/m/Y", strtotime("next monday")) . PHP_EOL;
echo date("d/m/Y H:i:s", strtotime("2016-01-01 tomorrow noon")) . PHP_EOL;
echo date("d/m/Y H:i:s", strtotime("2016-01-01 tomorrow noon +1 day")) . PHP_EOL;
echo date("d/m/Y", strtotime("2016-01-01 last friday")) . PHP_EOL;

// Saída
// 15/02/2016
// 02/01/2016 12:00:00
// 03/01/2016 12:00:00
// 25/12/2015

$dateTime = new DateTime("now");
echo date("d/m/Y H:i:s", $dateTime-&gt;getTimestamp()) . PHP_EOL;

$dateTime = new DateTime("now +1 month +2 days");
echo date("d/m/Y H:i:s", $dateTime-&gt;getTimestamp()) . PHP_EOL;

$dateTime = new DateTime("today -3 days");
echo date("d/m/Y", $dateTime-&gt;getTimestamp()) . PHP_EOL;

$dateTime = new DateTime("yesterday +1 day");
echo date("d/m/Y", $dateTime-&gt;getTimestamp()) . PHP_EOL;

// Saída
// 11/02/2016 22:33:30
// 13/03/2016 22:33:30
// 08/02/2016
// 11/02/2016
</code></pre>

<h2>Mais informações</h2>

<p>É fundamental entender cada função utilizada nesse <em>post</em> para que se possa ter cada vez mais facilidade para manipular datas. <strong>Lembrando</strong> que é sempre importante validar as datas antes fazer alguma manipulação, nos exemplos desse <em>post</em> não estou validando pois o principal intuído é mostrar como podemos trabalhar com datas.</p>

<p>Nos <em>links</em> a seguir podemos encontrar mais informações sobre cada uma das funções de data utilizadas nos exemplos.</p>

<ul>
<li><a href="http://php.net/manual/pt_BR/function.date.php"><code>date()</code></a></li>
<li><a href="http://php.net/manual/pt_BR/function.strtotime.php"><code>strtotime()</code></a></li>
<li><a href="http://php.net/manual/pt_BR/function.time.php"><code>time()</code></a></li>
<li><a href="http://php.net/manual/pt_BR/function.mktime.php"><code>mktime()</code></a></li>
<li><a href="http://br1.php.net/manual/pt_BR/function.strftime.php"><code>strftime()</code></a></li>
<li><a href="http://php.net/manual/en/class.datetime.php"><code>DateTime()</code></a></li>
</ul>
    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://lucasxciv.dev/blog/2016-01-26-iniciando-com-php-7" title="Older Post: Iniciando com PHP 7" class="text-base01 hover:text-base1">
                    &LeftArrow; Iniciando com PHP 7
                </a>
                    </div>

        <div>
                            <a href="https://lucasxciv.dev/blog/2016-02-13-instanciacao-de-variaveis-no-javascript" title="Newer Post: Instanciação de variáveis no JavaScript" class="text-base01 hover:text-base1">
                    Instanciação de variáveis no JavaScript &RightArrow;
                </a>
                    </div>
    </nav>

    <hr />
    <script src="https://giscus.app/client.js"
            data-repo="lucasxciv/lucasxciv.github.io"
            data-repo-id="MDEwOlJlcG9zaXRvcnk0NzYxOTYwMw=="
            data-category="Comments"
            data-category-id="DIC_kwDOAtaeE84CjAD7"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="noborder_light"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
        </main>

        <footer class="bg-base2 text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-none">
                <li class="md:mr-2">
                    &copy; 2015-2024 • <a href="https://lucasxciv.dev" title="@lucasxciv" class="text-base01 hover:text-base1">lucasxciv.dev</a> • All rights reserved.
                </li>
            </ul>
        </footer>

        <script src="/assets/build/js/main.js?id=e4a964d2b186fcedcfeb820ced60e3fb"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
</html>
